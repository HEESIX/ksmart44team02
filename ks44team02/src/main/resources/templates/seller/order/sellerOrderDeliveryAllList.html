<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/sellerDefault}">

<!-- 사용자 정의 title 설정  -->
<th:block layout:fragment="customTitle">
	<title th:text="${title}"></title>
</th:block>

<!-- 사용자 정의 css -->
<th:block layout:fragment="customCss">
<style>
	table {
    text-align: center;
    border: 1px solid #fff;
    border-spacing: 1px;
    font-family: 'Cairo', sans-serif;
}

table td {
    padding: 10px;
    background-color: #f8f9fa;
}

table th {
    background-color: #555;
    color: #fff;
    padding: 10px;
}
table td, th{
	width: 200px;
}

.orderBtn01,
.orderBtn02,
.orderBtn03,
.orderStatus {
    border: none;
    padding: 5px 10px;
    color: #fff;
    font-weight: bold;
     background-color: #7fad39;
}
.orderBtn04{
	border: none;
    padding: 5px 10px;
    color: #fff;
    font-weight: bold;
    width: 100%;
    background-color: #DFE0E0;
}
.orderBtn05{
	border: none;
    padding: 5px 10px;
    color: #fff;
    font-weight: bold;
    background-color: #555;
    float: right;
}
.orderStatus {
    background-color: #7fad39;
}
.modal-dialog.modal-80size {
  width: 50%;
  height: 50%;
  margin: 0;
  padding: 0;
}

.modal-content.modal-80size {
 position: relative;
  height: auto;
  min-height: 80%;
}

.modal.modal-center {
  text-align: center;
}

@media screen and (min-width: 768px) {
  .modal.modal-center:before {
    display: inline-block;
    vertical-align: middle;
    content: " ";
    height: 100%;
  }
}

.modal-dialog.modal-center {
  display: inline-block;
  text-align: left;
  vertical-align: middle;
}


li {
  list-style: none;
  cursor: pointer;
}

/* STYLE */
.main_con_form {
  text-align: left;
  padding: 20px;
}

.form_inner {
  width: 100%;
  height: 100%;
}
.main_con_form h1 {
  font-size: 28px;
}
.form_list_input {
  height: 100%;
  margin-top: 20px;
}
.form_list_input li {
  height: 54px;
}
.form_list_input input {
  padding: 0 1em; 
  border: solid #555;
  height: 38px;
  width: 100%;
  border-radius: 30px;
}
.form_list_input input:focus {
  outline: none;
  box-shadow: 0 0 0 3px #DFE0E0;
}
.form_list_input input::placeholder {
  font-weight: 300;
  color: #aaa;
}
.form_list_input label {
  float: left;
  display: none;
}


</style>
</th:block>



<!-- start breadcrum section -->
<th:block layout:fragment="customBreadCrum">
	<section class="breadcrumb-section set-bg"
		data-setbg="/user/img/breadcrumb.jpg">
		<div class="container">
			<div class="row">
				<div class="col-lg-12 text-center">
					<div class="breadcrumb__text">
						<h2>주문관리</h2>
						<div class="breadcrumb__option">
							<a th:href="@{/}">Home</a><span>Order List</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
</th:block>
<!-- end breadcrum section -->



<!-- 사용자 정의 contents  -->
<th:block layout:fragment="customContents">


<div class="row">
		<div class="product__discount">
		<div class="section-title product__discount__title">
					<h2 style="font-size: 30px">주문배송처리</h2>
			
		<div class="row" style="margin-bottom: 30px; margin-top: 30px;">
		
			<button class="orderBtn01" style="margin: 10px 0 0 10px;">결제완료</button>
			<button class="orderBtn02" style="margin: 10px 0 0 10px;">배송중</button>
			<button class="orderBtn03" style="margin: 10px 0 0 10px;">배송완료</button>
			<button class="orderBtn05" style="margin: 10px 0 0 10px;">취소/환불</button>
		
		</div>
		
		
		<div class="row">
		<div th:include="seller/order/searchOrderStatusList :: searchFragment" style="margin-bottom: 15px;"></div>
				<table style="margin-top: 15px;">
					<thead>
			            <tr>
							<th>주문번호</th>
							<th></th>
							<th>상품명</th>
							<th>구매수량</th>
							<th>결제금액</th>
							<th>주문일</th>
							<th>주문상태</th>
							<th>운송장번호</th>
							<th></th>
							<th></th>
			            </tr>
			        </thead>
			        <tbody>
			            <tr th:if="${not #lists.isEmpty(sellerOrderList)}"
			            	th:each="sol : ${sellerOrderList}">
			                <td th:text="${sol.orderDetailCode}"></td>
			                <td><a href="#"><img th:src="@{'/' + ${sol.goodsMainImageInfo.mainImagePath}}"
											th:alt="${sol.goodsMainImageInfo.mainImageOriginalName}" style="width: 100px; border-radius: 10px;"/></a></td>
			                <td th:text="${sol.goods.goodsName}"></td>
			                <td th:text="${sol.orderAmount}"></td>
			                <td th:if="${sol.regularPriceSubtotal} !=0" th:text="'₩ ' + ${sol.regularPriceSubtotal}"></td>
			                <td th:text="${sol.orderDateTime}"></td>
			                <td th:if="${sol.orderStatusStandard} != null" th:text="${sol.orderStatusStandard.orderStatusStandardDetails}"></td>
			                <td th:unless="${sol.orderStatusStandard} != null">결제완료</td>
			              	<td th:text="${sol.delivery.deliveryNum}"></td>
			              	<td><a th:href="@{|/seller/order/sellerOrderDeliveryModify/${sol.orderDetailCode}|}">상태변경</a></td>
			              	<td>
			              		<button type="button" class="btn btn-primary modalBtn">
									  운송장등록
								</button>
								<div class="modal modal-center fade" id="modal" tabindex="-1" role="dialog" aria-labelledby="my80sizeCenterModalLabel">
								  <div class="modal-dialog modal-80size modal-center" role="document">
								    <div class="modal-content modal-80size">
								      <div class="modal-header">
								        <h4 class="modal-title" id="myModalLabel">운송장 번호 등록</h4>
								        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
								      </div>
								      <div class="modal-body">
								       <div class="main_con_form">
										  <div class="form_inner">
											  <div>
											    <ul class="form_list_input">											    	
											      <li>
											      	<input type="hidden" id="orderDetailCodeModal" >
											      	<input type="text" id="deliNum_input" name="deliNum_input" placeholder="택배사/ 운송장 번호 입력">
											      </li>
											    </ul>
											  </div>
										  </div>
										</div>
								      </div>
								      <div class="modal-footer">
								        <button type="button" class="btn btn-default addDeliNum" data-dismiss="modal">등록</button>
								        <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
								      </div>
								    </div>
								  </div>
								</div>
			              	</td>
	
						</tr>
						<tr th:unless="${not #lists.isEmpty(sellerOrderList)}">
							<td colspan="5" style="text-align: center;">주문 내역이 존재하지않습니다.
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
		</div>
		
</div>
	

</th:block>
<th:block layout:fragment="customFootjs">
<script type="text/javascript" th:inline="javascript">
	$(function(){
		var msg = [[${msg}]];
		
		if(msg!=null) alert(msg);
		
		$(document).on('click', '.modalBtn', function(){
			let orderCode = $(this).parents('tr').children('td').eq(0).text();
			$('#orderDetailCodeModal' ).val(orderCode);
			$('#modal').modal("show"); //열기
			//
		});	
		
		$(document).on('click', '.addDeliNum', function(){
			let orderDetailCode = $('#orderDetailCodeModal').val();
			let deliNumInput = $('#deliNum_input').val();
			//ajax
			var request = $.ajax({
						  url: "/seller/order/addDeliNumber",
						  method: "POST",
						  data: { 
							  	   'orderDetailCode' : orderDetailCode 
							  	  ,'deliveryNum' : deliNumInput
							  	},
						  dataType: "text"
						});
						 
			request.done(function( data ) {
				if(data){
					alert('운송장 번호가 정상 등록되었습니다.')
					$('#modal').modal("hide"); //닫기 
					location.reload();
				}else{
					alert('운송장 번호가 등록되지 않았습니다.')
				}
			});
			 
			request.fail(function( jqXHR, textStatus ) {
			  alert( "Request failed: " + textStatus );
			});
			
		});
		
	});
 
</script>

</th:block>
</html>
